<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Vegas Casino Timeline</title>
  <!-- Orbitron font for that retro-futuristic vibe -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet"/>
  <!-- vis.js Timeline CSS -->
  <link href="https://unpkg.com/vis-timeline@latest/styles/vis-timeline-graph2d.min.css" rel="stylesheet"/>
  <style>
    body, html { margin:0; padding:0; height:100%; background:#111; color:#eee; font-family:'Orbitron', sans-serif; }
    #timeline { width:100%; height:100%; }

    /* ---- Lifespan Bars ---- */
    .vis-item-lifespan-open   { background:#0f0; border-color:#0f0; box-shadow:0 0 8px #0f0; }
    .vis-item-lifespan-closed { background:#555; border-color:#555; box-shadow:0 0 4px #555; }

    /* ---- Event Markers ---- */
    .vis-item-namechange  { color:#ff0; font-size:16px; }
    .vis-item-demolition  { color:#f00; font-size:16px; }

    /* ---- Axis Styling ---- */
    .vis-timeline .vis-axis .vis-text       { fill:#888; text-shadow:0 0 4px #000; }
    .vis-timeline .vis-grid .vis-grid-line  { stroke:#333; }
    .vis-timeline .vis-group .vis-label     { color:#ccc; font-weight:700; }

    /* ---- Legend Overlay ---- */
    #legend {
      position:absolute; top:10px; right:10px;
      background:rgba(0,0,0,0.7);
      padding:10px; border-radius:6px;
      font-size:14px; line-height:1.4;
      z-index:10;
    }
    #legend h4 { margin:0 0 5px; font-size:16px; }
    .legend-item { display:flex; align-items:center; margin-bottom:4px; }
    .legend-swatch { width:12px; height:12px; margin-right:6px; border-radius:2px; }
    .legend-open   { background:#0f0; box-shadow:0 0 6px #0f0; }
    .legend-closed { background:#555; box-shadow:0 0 4px #555; }
    .legend-rename, .legend-demo { font-size:16px; }
  </style>
</head>
<body>

  <div id="legend">
    <h4>Legend</h4>
    <div class="legend-item"><span class="legend-swatch legend-open"></span>Operating</div>
    <div class="legend-item"><span class="legend-swatch legend-closed"></span>Closed</div>
    <div class="legend-item legend-rename">✎ Name Change</div>
    <div class="legend-item legend-demo">✘ Demolition</div>
  </div>

  <div id="timeline"></div>

  <script src="https://unpkg.com/vis-timeline@latest/standalone/umd/vis-timeline-graph2d.min.js"></script>
  <script>
    // Dynamically build the JSON URL to avoid caching issues
    const base = window.location.origin + window.location.pathname.replace(/[^/]*$/, '');
    const url  = base + 'list_full.json?v=' + Date.now();

    fetch(url)
      .then(r => { if(!r.ok) throw new Error('HTTP ' + r.status); return r.text(); })
      .then(text => {
        // Merge multiple top-level arrays into one
        const fixed = text.replace(/]\s*\[/g, ',');
        return JSON.parse(fixed);
      })
      .then(raw => {
        // Build groups by Location Category
        const cats = [...new Set(raw.map(c => c['Location Category'] || 'Unknown'))];
        const groups = new vis.DataSet(cats.map((cat,i)=>({ id: i+1, content: cat })));

        // Flatten into lifespan bars + event markers
        const items = new vis.DataSet();
        raw.forEach((c,i) => {
          const gid  = cats.indexOf(c['Location Category']||'Unknown') + 1;
          const name = c['Casino Name'] || 'Unnamed Casino';
          // Lifespan bar
          if(c['Open Date']) {
            const start = c['Open Date'];
            const end   = c['Close Date'] || new Date().toISOString().slice(0,10);
            const cls   = c['Close Date']
                          ? 'vis-item-lifespan-closed'
                          : 'vis-item-lifespan-open';
            items.add({ id:`life-${i}`, group:gid, content:name, start, end, className:cls });
          }
          // Name Change marker
          if(/Renamed/i.test(c['Status'])) {
            const d = c['Close Date'] || c['Open Date'];
            items.add({ id:`ren-${i}`, group:gid, content:'✎', start:d, type:'point', className:'vis-item-namechange' });
          }
          // Demolition marker
          if(/Demolished/i.test(c['Status'])) {
            const d = c['Close Date'] || c['Open Date'];
            items.add({ id:`dem-${i}`, group:gid, content:'✘', start:d, type:'point', className:'vis-item-demolition' });
          }
        });

        // Timeline options
        const opts = {
          stack: true,
          horizontalScroll: true,
          zoomKey: 'ctrlKey',
          maxHeight: '100%',
          start: '1900-01-01',
          end:   '2025-12-31',
          groupOrder: 'id'
        };

        new vis.Timeline(document.getElementById('timeline'), items, groups, opts);
      })
      .catch(err => {
        console.error(err);
        const e = document.createElement('div');
        e.textContent = 'Error: ' + err.message;
        e.style.position = 'absolute'; e.style.top='50%'; e.style.left='50%';
        e.style.transform='translate(-50%,-50%)'; e.style.color='#f66';
        document.body.appendChild(e);
      });
  </script>
</body>
</html>
